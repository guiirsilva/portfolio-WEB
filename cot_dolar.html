<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consultor de Cota√ß√£o de D√≥lar</title>
    <link rel="stylesheet" href="base.css">
</head>
<body>
    <header class="header">
        <h1 id="titulo-projeto">Consultor de Cota√ß√£o de D√≥lar</h1>
        <a id="btn-github" href="https://github.com/guiirsilva/portfolio-WEB/blob/main/Exercicios_Geral/cotar_dolar.py" target="_blank" class="botao-github">Ver no GitHub</a>
        <a id="btn-voltar" href="index.html" class="botao-github">Voltar ao In√≠cio</a>
    </header>

    <section class="descricao">
        <h2>Descri√ß√£o</h2>
        <p>
            Este sistema consulta automaticamente a cota√ß√£o do d√≥lar fornecida pelo Banco Central do Brasil (via API PTAX). Ele recebe datas no formato ‚ÄúMMDDYYYY‚Äù, converte para o formato aceito pela API, faz a requisi√ß√£o e retorna o valor da cota√ß√£o de venda.
            Caso a API n√£o tenha cota√ß√£o registrada para o dia solicitado (por exemplo feriados ou finais de semana), o sistema volta um dia e tenta novamente at√© encontrar um dia v√°lido.
            No final, ele cria uma lista com as cota√ß√µes correspondentes para v√°rias datas passadas e imprime o resultado.
        </p>
    </section>

    <section class="explicacao-codigo">
        <h2>Explica√ß√£o do C√≥digo</h2>
        <div class="bloco-explicacao">
            <h3>üîπ Parte 1 ‚Äî Explica√ß√£o</h3>
            <p>Essa fun√ß√£o converte uma data no formato MMDDYYYY para o formato MM-DD-YYYY, que √© o formato exigido pela API.</p>
            <pre><code>
def formatar_data(data_str):
    dt = datetime.strptime(data_str, "%m%d%Y")
    return dt.strftime("%m-%d-%Y")
            </code></pre>
        </div>

        <div class="bloco-explicacao">
            <h3>üîπ Parte 2 ‚Äî Explica√ß√£o</h3>
            <p>Essa fun√ß√£o retorna a data imediatamente anterior √† fornecida, ainda no formato MMDDYYYY. Ela s√≥ diminui um dia e devolve no mesmo formato original.</p>
            <pre><code>
def dia_anterior(data_str):
    dt = datetime.strptime(data_str, "%m%d%Y") - timedelta(days=1)
    return dt.strftime("%m%d%Y")
            </code></pre>
        </div>

        <div class="bloco-explicacao">
            <h3>üîπ Parte 3 ‚Äî Explica√ß√£o</h3>
            <p>Essa fun√ß√£o busca a cota√ß√£o do d√≥lar para uma data.
                Primeiro formata a data para o padr√£o da API.
                Depois faz a requisi√ß√£o HTTP ao Banco Central.
                Se existir valor para aquele dia, retorna a cota√ß√£o.
                Se n√£o existir, chama a si mesma usando o dia anterior at√© encontrar uma data v√°lida.
                No fim, cria uma lista de datas e aplica a fun√ß√£o cotar em cada uma, produzindo uma lista com as cota√ß√µes correspondentes. Depois imprime o resultado.</p>
            <pre><code>
def cotar(data_str):
    data_ptax = formatar_data(data_str)

    url = (
        "https://olinda.bcb.gov.br/olinda/servico/PTAX/versao/v1/odata/"
        f"CotacaoDolarDia(dataCotacao=@dataCotacao)?@dataCotacao='{data_ptax}'&$format=json"
    )

    res = requests.get(url).json()

    if res.get("value"):
        return float(res["value"][0]["cotacaoVenda"])

    return cotar(dia_anterior(data_str))

    resultados = [cotar(i) for i in ["09022024", "09012024", "08312024", "08302024", "08292024"]]
    print(resultados)
            </code></pre>
        </div>
    </section>

    <section class="codigo-completo">
        <h2>C√≥digo Completo</h2>
        <pre><code>
from datetime import datetime, timedelta
import requests

def formatar_data(data_str):
    dt = datetime.strptime(data_str, "%m%d%Y")
    return dt.strftime("%m-%d-%Y")

def dia_anterior(data_str):
    dt = datetime.strptime(data_str, "%m%d%Y") - timedelta(days=1)
    return dt.strftime("%m%d%Y")

def cotar(data_str):
    data_ptax = formatar_data(data_str)

    url = (
        "https://olinda.bcb.gov.br/olinda/servico/PTAX/versao/v1/odata/"
        f"CotacaoDolarDia(dataCotacao=@dataCotacao)?@dataCotacao='{data_ptax}'&$format=json"
    )

    res = requests.get(url).json()

    if res.get("value"):
        return float(res["value"][0]["cotacaoVenda"])

    return cotar(dia_anterior(data_str))

resultados = [cotar(i) for i in ["09022024", "09012024", "08312024", "08302024", "08292024"]]
print(resultados)
        </code></pre>
    </section>
</body>
</html>
